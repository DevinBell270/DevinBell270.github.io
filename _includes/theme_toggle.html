<div class="theme-toggle">
  <label class="mac-toggle" for="darkModeToggle">
    <div class="mac-switch">
      <input type="checkbox" id="darkModeToggle">
      <span class="slider"></span>
    </div>
  </label>
</div>

<script>
  (function() {
    // Get theme from localStorage or default to 'light'
    const currentTheme = localStorage.getItem('theme') || 'light';
    
    // Apply theme immediately by setting attribute on body element
    // The no-style-please theme uses body[a="dark"] for dark mode
    if (currentTheme === 'dark') {
      document.body.setAttribute('a', 'dark');
    } else {
      document.body.setAttribute('a', 'light');
    }
    
    // Wait for DOM to be ready before initializing toggle
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initToggle);
    } else {
      initToggle();
    }
    
    function initToggle() {
      const toggle = document.getElementById('darkModeToggle');
      
      if (!toggle) {
        return;
      }
      
      // Set checkbox state based on current theme
      toggle.checked = currentTheme === 'dark';
      
      // Toggle theme on checkbox change
      toggle.addEventListener('change', function() {
        const newTheme = this.checked ? 'dark' : 'light';
        document.body.setAttribute('a', newTheme);
        localStorage.setItem('theme', newTheme);
      });
    }
  })();
</script>
